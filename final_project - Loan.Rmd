Final Project by Wonjun Lee
========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
df <- read.csv("c:/udacity/r_project/prosperLoanData.csv")
names(df)
```

# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
dim(df)
summary(df)
str(df)
```

There are 81 variables with 113937 observations.
Plotting a histogram for each variable will be helpful in understanding the data set. I will only use variables that are not factors.

### Finding good variables
```{r}
library(dplyr)

colSums(is.na(df))
```

This will help me filter out variables with too many NA's.

### Term
```{r}
ggplot(aes(x=Term), data=df) +
  geom_histogram(bins=30)
```

There are only 3 terms people use. More specifically,

```{r}
table(df$Term)
df$Term <- factor(df$Term)
```

12, 36 and 60. Term will be used as a factored variable.

### Borrower Rate, Borrower APR, Lender Yield, EstimatedEffectiveYield
```{r}
ggplot(aes(x=BorrowerAPR), data=df) +
  geom_histogram(bins=100)
ggplot(aes(x=BorrowerRate), data=df) +
  geom_histogram(bins=100)
ggplot(aes(x=LenderYield), data=df) +
  geom_histogram(bins=100)
ggplot(aes(x=EstimatedEffectiveYield), data=df) +
  geom_histogram(bins=100)
```

The graphs are similar to each other. Right skewed graph with an abnormal peak at the right. I will only use Borrower Rate for convenience.

### Borrower Rate

Without the high peak around at .36 the histogram is almost a right skewed graph. According to the graph, there is a very popular APR near at .36. Let's find the exact value of it.

```{r}
df %>%
  group_by(BorrowerRate) %>%
  summarise(Count=n()) %>%
  arrange(desc(Count))
```

.3177 is the most popular APR being applied.
Cutting the variable and using it as a factored variable might be more useful.

```{r}
df$BorrowerAPR.bucket <- cut(df$BorrowerAPR,breaks=10)
table(df$BorrowerAPR.bucket)
```

### Estimated Return
```{r}
ggplot(aes(x=EstimatedReturn), data=df) +
  geom_histogram(bins=30)
```

This looks a right skewed graph with outliers less than 0.0.

```{r}
ggplot(aes(x=EstimatedReturn), data=df) +
  geom_histogram(bins=100)
```

The graph with more bins shows clear outliers with negative values and more than 0.2.

```{r}
summary(df$EstimatedReturn)

df$EstimatedReturn.bucket <- cut(df$EstimatedReturn, c(-0.1,0,0.2,0.3))
table(df$EstimatedReturn.bucket)
```

There are 176 observations less than 0.0 and 80 observations more than 0.2.
```{r}
ggplot(aes(x=EstimatedReturn), data=subset(df,df$EstimatedReturn>0 & df$EstimatedReturn<0.2)) +
  geom_histogram(bins=50)
  scale_x_sqrt()
```

The graph is drawn after Estimated Return is filtered (more than 0 and less than 0.2). Similar to the previous variables, there is a peak at the right.

### Prosper Score
```{r}
ggplot(aes(x=ProsperScore
), data=df) +
  geom_histogram(binwidth=.5)

table(df$ProsperScore)
```

Prosper score is ranging from 1 to 11.

```{r}
df$ProsperScore <- factor(df$ProsperScore)
```

Prosper score is factored.

### Employment Status Duration
```{r}
ggplot(aes(x=EmploymentStatusDuration), data=df) +
  geom_histogram(bins=100)
```

This is very nice looking right skewed graph without a peak at the right.

```{r}
ggplot(aes(x=EmploymentStatusDuration), data=df) +
  geom_histogram(bins=100) +
  scale_x_sqrt()
```

Square root is applied. 

### pH
```{r}
ggplot(aes(x=pH), data=df) +
  geom_histogram()
```

### Sulphates
```{r}
ggplot(aes(x=sulphates), data=df) +
  geom_histogram()
```

### Alcohol
```{r}
ggplot(aes(x=alcohol), data=df) +
  geom_histogram(binwidth=.1) 
```

### Quality
```{r}
ggplot(aes(x=quality), data=df) +
  geom_histogram()
```


### More graphs with density and quality
I got interested in the relationship between the density and the quality.
```{r}
ggplot(aes(x=density),data=df) +
  geom_histogram() +
  facet_wrap(~quality)
```

```{r}
table(df$quality)
```

Facet wrap shows that most of wines have qualities of 5 and 6.
The summary shows that there are not many quality of 3 and 8.
However, regardless of the quality of the wine, the density is usually .996.

```{r}
df %>%
  group_by(quality) %>%
  summarise(mean=mean(density))
```

The means are very close to each other.


# Univariate Analysis

### What is the structure of your dataset?
There are 1599 observations and 13 variables.
```{r}
str(df)
```
Quality is the only ordered factor variable with the following levels.
```{r}
table(df$quality)
```

### What is/are the main feature(s) of interest in your dataset?

I am interested in finding which variable affects the quality the most.
Then I will find the value of each variable that defines the best quality of wines.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

Density is already checked and density shows the similar pattern regardless of the quality. So other variables have to be analyzed.

### Did you create any new variables from existing variables in the dataset?

According to the description of the data set, the citric acid adds freshness to wines, residual sugar adds sweet and volatile acidity adds unpleasant taste to wines. I thought that ratio of the sum of citric acid and residual sugar to volatile acidity might be interesting so I created the ratio of interest as below.

```{r}
# Checking if there is any zero in volatile.acidity
df %>%
  filter(df$volatile.acidity == 0) %>%
  summarise(n=n())

# Creating New Variable
df$ratio_interest <- (df$citric.acid + df$residual.sugar) / df$volatile.acidity

# Graphing a histogram
ggplot(aes(x=ratio_interest), data=df) +
  geom_histogram(bins=100)
```

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

When creating the new variable, since the variable is a fraction, the denominator has to be nonzero values. After checking with dplyr library, there is no zero in volatile acidity.

In a histogram for citric acid, there are two abnormal peaks at near 0.00 and near 0.50. After applying log10, the left skewed graph can be observed. Fairly large number of observations are between 0.01 and 0.10 values and many gaps can be found in this interval. According to the data set description, citric acid is found in a small quantity. To fill the gap of the data, citric acid is added with residual sugar because both of these variables account for the pleasantness of wines.


# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}
#install.packages('alr3')
#install.packages('stats')
library(alr3)
library(stats)
cor(df[,c(2:12,14)],method='pearson')

#install.packages('GGally')
library(GGally)
df_sample <- df[,c(2:14)]

ggpairs(df_sample,
  lower = list(continuous = wrap("points", shape = I('.'))), 
  upper = list(combo = wrap("box", outlier.shape = I('.'))))
```

First of all of acidic variables (fixed.acidity and citric.acid) are negatively correlated to pH. This is very reasonable because low pH value means high acidic value. 

```{r}
df$quality <- factor(df$quality,labels=c(3,4,5,6,7,8))

str(df)
ggplot(aes(x=pH,y=fixed.acidity), data=df_sample) +
  geom_point(alpha = 0.5, size = 2, position = 'jitter') +
  scale_fill_brewer(type = 'div')

cor.test(df$pH, df$fixed.acidity)

ggplot(aes(x=pH,y=citric.acid),data=df_sample) +
  geom_point(alpha=.5)

cor.test(df$pH, df$citric.acid)
```


Density is positively correlated to fixed.acidity and citric.acid and negatively correlated to alcohol. 


```{r}
ggplot(aes(x=density,y=fixed.acidity), data=df) +
  geom_point(alpha=0.5, size=2, position='jitter')

cor.test(df$density, df$fixed.acidity)

ggplot(aes(x=density,y=citric.acid), data=df) +
  geom_point(alpha=0.5, size=2, position='jitter')
cor.test(df$density, df$citric.acid)
```

citric acid is not correlated to density as much as fixed acidity.


# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

### What was the strongest relationship you found?




# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
